{% extends 'base.html' %}

{% block content %}
<section class="section bg-estelar">
  <div class="container">
    <h1 class="title has-text-warning has-text-centered" style="font-size: 8rem;">ðŸŽ¬ DIRECTORES</h1>

    <!-- âœ… MENSAJE DE CONFIRMACIÃ“N -->
    {% if mensaje %}
      <div class="notification is-success is-light has-text-centered">
        {{ mensaje }}
      </div>
    {% endif %}

    <!-- âœ… FORMULARIO PARA CREAR DIRECTOR -->
    <div class="box" style="margin-top: 2rem; background: rgba(0,0,0,0.8); border: 3px solid #e62429;">
      <h2 class="title is-3 has-text-warning has-text-centered">Agregar nuevo director</h2>

      <form action="/directores" method="post" enctype="multipart/form-data">
        <div class="columns">
          <div class="column is-half">

            <div class="field">
              <label class="label has-text-white">Nombre</label>
              <div class="control">
                <input class="input" type="text" name="nombre" required>
              </div>
            </div>

            <div class="field">
              <label class="label has-text-white">BiografÃ­a</label>
              <div class="control">
                <textarea class="textarea" name="biografia" required></textarea>
              </div>
            </div>

          </div>

          <div class="column is-half">

            <div class="field">
              <label class="label has-text-white">Imagen</label>
              <div class="control">
                <input class="input" type="file" name="imagen" accept="image/png,image/jpeg,image/webp">
              </div>
            </div>

            <div class="field has-text-centered" style="margin-top: 2rem;">
              <button class="button is-danger is-medium">
                Guardar director
              </button>
            </div>

          </div>
        </div>
      </form>
    </div>
    <!-- âœ… FIN FORMULARIO -->

  </div>

  <div class="columns is-multiline is-centered">
    {% for director in directores %}
      <div class="column is-one-third">

        <!-- âœ… AGREGADO: ID PARA QUE LA BÃšSQUEDA PUEDA SALTAR AQUÃ -->
        <div class="pelicula-card" id="card-{{ director.id }}">

          <a href="/directores/{{ director.nombre }}/page">
            <div class="pelicula-card-image">

              {% set imagen_url = director.imagen_url %}

              {% if imagen_url is none %}
                {% for pelicula in director.peliculas %}
                  {% if pelicula.imagen_url %}
                    {% set imagen_url = pelicula.imagen_url %}
                  {% endif %}
                {% endfor %}
              {% endif %}

              {% if imagen_url %}
                <img src="{{ imagen_url }}" alt="{{ director.nombre }}">
              {% else %}
                <div class="placeholder"><span class="placeholder-text">SIN IMAGEN</span></div>
              {% endif %}

            </div>

            <div class="pelicula-overlay">
              <h2 class="title is-3 has-text-warning pelicula-titulo">{{ director.nombre }}</h2>
            </div>
          </a>

          <!-- âœ… BOTÃ“N DE ELIMINAR (CORREGIDO _method â†’ method) -->
          <form action="/directores/{{ director.nombre }}" method="post" style="margin-top: 1rem;" onsubmit="return confirm('Â¿Eliminar este director?');">
            <input type="hidden" name="method" value="delete">
            <div class="has-text-centered">
              <button class="button is-small is-danger">Eliminar</button>
            </div>
          </form>

        </div>
      </div>
    {% endfor %}
  </div>

  {% if directores|length == 0 %}
    <div class="has-text-centered">
      <p class="has-text-grey is-size-4">No hay directores registrados aÃºn.</p>
    </div>
  {% endif %}
</section>
{% endblock %}