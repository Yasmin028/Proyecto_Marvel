{% extends 'base.html' %}

{% block content %}
<section class="section bg-estelar">
  <div class="container">
    <h1 class="title has-text-warning has-text-centered" style="font-size: 8rem;">üé¨ PEL√çCULAS</h1>
    <p class="subtitle is-3 has-text-white has-text-centered">Explora las pel√≠culas del universo Marvel</p>

    <!-- ‚úÖ MENSAJE DE CONFIRMACI√ìN -->
    {% if mensaje %}
      <div class="notification is-success is-light has-text-centered">
        {{ mensaje }}
      </div>
    {% endif %}

    <!-- ‚úÖ MENSAJE DE ERROR -->
    {% if mensaje_error %}
      <div class="notification is-danger is-light has-text-centered">
        {{ mensaje_error }}
      </div>
    {% endif %}

    {# ‚úÖ FORMULARIO PARA CREAR PEL√çCULA #}
    <div class="box" style="margin-top: 2rem; background: rgba(0,0,0,0.8); border: 3px solid #e62429;">
      <h2 class="title is-3 has-text-warning has-text-centered">Agregar nueva pel√≠cula</h2>

      <form action="/peliculas" method="post" enctype="multipart/form-data">
        <div class="columns">
          <div class="column is-half">

            <div class="field">
              <label class="label has-text-white">T√≠tulo</label>
              <div class="control">
                <input class="input" type="text" name="titulo" required>
              </div>
            </div>

            <div class="field">
              <label class="label has-text-white">A√±o</label>
              <div class="control">
                <input class="input" type="number" name="a√±o" required>
              </div>
            </div>

            <div class="field">
              <label class="label has-text-white">Director</label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select name="director_id" required>
                    {% for director in directores %}
                      <option value="{{ director.id }}">{{ director.nombre }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>

          </div>

          <div class="column is-half">
            <div class="field">
              <label class="label has-text-white">Imagen</label>
              <div class="control">
                <input class="input" type="file" name="imagen" accept="image/png,image/jpeg,image/webp">
              </div>
            </div>

            <div class="field has-text-centered" style="margin-top: 2rem;">
              <button class="button is-danger is-medium">
                Guardar pel√≠cula
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
    {# ‚úÖ FIN FORMULARIO #}

  </div>

  <div class="columns is-multiline is-centered">
  {% for pelicula in peliculas %}
    <div class="column is-one-third">

      <div class="pelicula-card">

        <a href="/peliculas/{{ pelicula.id }}/page">
          <div class="pelicula-card-image">

            {% if pelicula.imagen_url %}
              <img src="{{ pelicula.imagen_url }}" alt="{{ pelicula.titulo }}">
            {% else %}
              <div class="placeholder">
                <span class="placeholder-text">SIN IMAGEN</span>
              </div>
            {% endif %}

          </div>

          <div class="pelicula-overlay">
            <h2 class="title is-3 has-text-warning pelicula-titulo">{{ pelicula.titulo }}</h2>
          </div>
        </a>

        <!-- ‚úÖ BOT√ìN DE ELIMINAR -->
        <form action="/peliculas/eliminar/{{ pelicula.id}}" method="post"
      onsubmit="return confirm('¬øEliminar?');">
  <input type="hidden" name="method" value="delete">
  <button class="button is-small is-danger">Eliminar</button>
</form>
      </div>

    </div>
  {% endfor %}
</div>

  {% if peliculas|length == 0 %}
    <div class="has-text-centered">
      <p class="has-text-grey is-size-4">No hay pel√≠culas registradas a√∫n.</p>
    </div>
  {% endif %}
</section>
{% endblock %}